<vex-page-layout>
  <vex-page-layout-header
    class="pb-16"
    fxLayout="column"
    fxLayoutAlign="center start"
  >
    <div class="w-full flex flex-col sm:flex-row justify-between">
      <div>
        <h1 class="title mt-0 mb-1">Transactions Details</h1>
        <vex-breadcrumbs
          [crumbs]="['Dashboard', 'Transactions', 'Transaction-details']"
        ></vex-breadcrumbs>
      </div>
    </div>
  </vex-page-layout-header>

  <vex-page-layout-content
    [class.container]="true"
    [class.px-gutter]="true"
    class="-mt-16"
  >
    <div>
      <div class="grid grid-flow-col grid-cols-3 grid-rows-1 gap-4 bg-app-bar px-6 h-16 border-b sticky left-0">
        <div class="col-span-2">
          <div class="grid grid-flow-col grid-cols-3 grid-rows-1">
            <div>
              <div class="grid grid-flow-col grid-cols grid-rows-2 gap-4">
                <div>
                  <div class="grid grid-flow-col grid-cols-2 grid-rows-1 mt-2">
                    <div class="ml-2">
                      <img class="block w-6 h-6 rounded-full" [src]="buyerPhototURL" />
                    </div>
                    <div class="-ml-12">
                      <span class="text-xs text-gray-300"
                        >{{ transactionDetails?.initiator_name }}
                        {{ transactionDetails?.initiator_first_name }}</span
                      >
                    </div>
                  </div>
                </div>
                <div>
                  <div class="grid grid-flow-col grid-cols-2 grid-rows-1 gap-8">
                    <div style="margin-top: -14px">
                      <ic-icon [icIcon]="icPhone" size="20px"></ic-icon>
                    </div>
                    <div class="-ml-16 -mt-4">
                      <span class="text-xs text-gray-300">
                        {{ transactionDetails?.initiator_phone }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div>
              <div class="grid grid-flow-col grid-cols-2 grid-rows-1 mt-5">
                <div class="-ml-12 mt-4">
                  <ic-icon [icIcon]="icMap" size="20px"></ic-icon>
                </div>
                <div class="-ml-16 mt-2" style="margin-top: 13px">
                  <span class="text-xs text-gray-300">
                    {{ transactionDetails?.initiator_address }}
                  </span>
                </div>
              </div>
            </div>
            <div>
              <div class="grid grid-flow-col grid-cols-2 grid-rows-1 mt-12">
                <div class="-ml-4 -mt-4">
                  <ic-icon [icIcon]="icEmail" size="20px"></ic-icon>
                </div>
                <div class="-ml-12 -mt-4">
                  <span class="text-xs text-gray-300">
                    {{ transactionDetails?.initiator_email }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div>
          <div class="grid grid-cols-3 col-end-7">
            <div class="mt-2">
              <ic-icon [icIcon]="icLock" size="20px"></ic-icon>
            </div>
            <div class="-ml-8 mt-2">
              <h3 class="text-md text-gray-300">
                {{ transactionDetails?.price }}
                {{ transactionDetails?.currency }}
              </h3>
            </div>
            <div class="mt-2">
              <ic-icon
                style="color: rgb(197, 55, 55); cursor: pointer"
                [icIcon]="icCancel"
                size="20px"
              ></ic-icon>
            </div>
          </div>
        </div>
      </div>

      <div>
        <div class="grid grid-cols-3 pb-20 bg-white">
          <div class="col-span-2">
            <div class="flex mt-4 ml-4">
              <div class="grid grid-flow-col grid-cols-1">
                <ic-icon
                  class="text-red"
                  [icIcon]="icInfo"
                  size="20px"
                ></ic-icon>
                <p class="text-xs text-gray-300 text-red">
                  This transaction can only be cancelled by you
                </p>
              </div>
            </div>
            <div class="flex mt-4 ml-4">
              <div class="grid grid-flow-col grid-cols-1">
                <ic-icon
                  class="text-red"
                  [icIcon]="icInfo"
                  size="20px"
                ></ic-icon>
                <p class="text-xs text-gray-300 text-red">
                  Custumer must acknowledge receipe of goods with the delivery
                  code this will release the money to your account
                </p>
              </div>
            </div>

            <hr class="mt-4 bg-gray h-0.90 w-900" />

            <table
              mat-table
              [dataSource]="dataSource"
              class="mat-elevation-z8 w-full ml-2 mt-4 px-7"
              matSort
            >
              <!--  Column -->
              <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef>Item ID</th>
                <td mat-cell *matCellDef="let item">
                  {{ item?.item_id }}
                </td>
              </ng-container>

              <!--  Column -->
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Item name</th>
                <td mat-cell *matCellDef="let item">
                  {{ item?.name }}
                </td>
              </ng-container>

              <!--  Column -->
              <ng-container matColumnDef="description">
                <th mat-header-cell *matHeaderCellDef>Desription</th>
                <td mat-cell *matCellDef="let item">
                  {{ item?.description }}
                </td>
              </ng-container>

              <!--  Column -->
              <ng-container matColumnDef="qty">
                <th mat-header-cell *matHeaderCellDef>Quantity</th>
                <td mat-cell *matCellDef="let item">{{ item?.items_qty }}</td>
              </ng-container>

              <!--  Column -->
              <!-- <ng-container matColumnDef="unity price">
                <th mat-header-cell *matHeaderCellDef>Unity price</th>
                <td mat-cell *matCellDef="let item">{{ item?.price }}</td>
              </ng-container> -->

              <!--  Column -->
              <ng-container matColumnDef="total">
                <th mat-header-cell *matHeaderCellDef>Total</th>
                <td mat-cell *matCellDef="let item">
                  {{ transactionDetails?.price }}
                </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

              <!-- Row shown when there is no matching data. -->
              <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="4">No data Data Found!</td>
              </tr>
            </table>
            <hr class="mt-4 bg-gray h-0.90 w-900" />

            <div
              class="grid grid-flow-col grid-cols-2 ml-4 mt-2 grid-rows-1 gap-8 bg-app-bar px-6 h-8 border-b sticky left-0"
            >
              <div>
                <h6 class="ml-4">Amount secured</h6>
              </div>
              <div class="flex flex-wrap w-24 -pr-8 ml-48">
                <ic-icon
                  style="color: rgb(75, 75, 214)"
                  [icIcon]="icLock"
                  size="20px"
                ></ic-icon>
                <h6 class="text-right">
                  {{ transactionDetails?.price }}
                  {{ transactionDetails?.currency }}
                </h6>
              </div>
            </div>
          </div>
          <div>
            <div class="h-64 grid grid-rows-2 grid-flow-col-1 gap-4">
              <div>
                <div
                  class="grid grid-flow-col grid-cols-1 ml-4  mt-2 grid-rows-1 gap-8  bg-app-bar px-6 h-8 border-b sticky left-0"
                >
                  <div>
                    <h6 class="text-center w-100">
                      Delivery code confirmation
                    </h6>
                  </div>
                </div>
                <div>
                  <h3 class="text-center w-100 mt-10">
                    {{ transactionDetails?.release_code }}
                  </h3>
                </div>
              </div>

              <div>
                <div>
                  <div
                    class="grid grid-flow-col grid-cols-1 ml-4 mt-2 grid-rows-1 gap-8 bg-app-bar px-6 h-16 border-b sticky left-0"
                  >
                    <div>
                      <h6 class="text-center w-100">Dispatch Rider contact</h6>
                      <p class="text-center text-gray-300 text-xs w-100">
                        Every time you will change the dispatch rider,the
                        custumer will get modified
                      </p>
                    </div>
                  </div>
                  <div  [formGroup]="form" *ngIf="displayPhoneInput" class="ml-20 mt-4">
                    <p>
                      <mat-form-field appearance="legacy">
                        <input matInput type="text" formControlName="newDeliveryNo"/>
                        <span matPrefix>{{ prefixCountryCode }}</span>
                        <mat-error *ngIf="form?.status === 'INVALID'">Please enter a valid phone number
                        </mat-error>              
                      </mat-form-field>
                    </p>
                    <div>
                      <button
                        mat-raised-button
                        style="width: 180px"
                        color="primary"
                        (click)="updateDeliveryPhone()"
                        [disabled]="form?.status === 'INVALID'"
                      >
                        Change
                      </button>
                    </div>
                  </div>
                  <div
                    class="grid grid-flow-col grid-cols-1 text-center mt-4"
                    *ngIf="!displayPhoneNumber"
                  >
                    <h5 class="text-md mr-8 text-gray-300"> {{ transactionDetails?.delivery_phone }}</h5>
                    <ic-icon
                      [icIcon]="icEdit"
                      class="-ml-56"
                      (click)="onDisplayInput()"
                      style="cursor: pointer; color: rgb(75, 75, 214)"
                      size="20px"
                    ></ic-icon>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </vex-page-layout-content>
</vex-page-layout>
